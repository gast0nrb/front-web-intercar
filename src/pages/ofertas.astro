---
import Layout from "../layouts/Layout.astro";
import Pagination from "../components/Pagination.astro";
import Card from "../components/Card.astro";
import NamePage from "../components/category/NamePage.astro";

let apiUrl = "http://localhost:8080/api/intercar/onsale/products?page=0"; //Url de base
const getOnSaleProduct = async () => {
	try {
		const fetchProducts = await fetch(apiUrl, {
			method: "GET",
			mode: "cors",
		});
		const jsonProducts = await fetchProducts.json();
		return jsonProducts;
	} catch (err) {
		return err;
	}
};
const data = await getOnSaleProduct();

---

<Layout>
	{
	(data.success || Array.isArray(data.data)) ? (
<NamePage pages={data.length}/>
	<div class="mb-10 mt-10 ">
		<div class="grid md:grid-cols-3 w-11/12 mx-auto gap-10">
			{data.data.map((p: any) => <Card sku={p.sku} title={p.title}, price={p.price} subcategory={p.SUBCATEGORY}/>)}
		</div>
		<Pagination url={`${Astro.request.url}`} pages={data.length}/>
	</div>
)
: (
<p class="text-center mt-10 text-zinc-500">Problemas cargando la informaci√≥n (productos)...</p>
<a href="/" class="block text-center p-1 bg-neutral-800 w-fit mx-auto rounded-xs text-zinc-500 hover:text-white">Volver al inicio</a>
)
}
</Layout>